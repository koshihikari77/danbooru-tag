# 問い・仮説棚卸し

このドキュメントは、分析したい問いと仮説を整理するものです。

## 主要問い

### 1. タグ階層の完全性

**問い**: タグ階層構造は完全か？

- すべてのタグが適切な親を持っているか？
- 循環参照や欠損はないか？
- 統合処理によるデータ不整合はないか？

**仮説**:
- 一部のタグは階層が不完全（中間親が欠如している可能性）
- 統合処理によって一部の階層情報が失われている可能性

**検証方法**:
- タグ階層の深さ分布を確認
- parentフィールドのNULL/空文字の数を確認
- 循環参照検出アルゴリズムを適用

### 2. 特徴分類の精度

**問い**: feature_categoryの分類はどの程度正確か？

- character/non_character/ambiguousの分類は信頼できるか？
- ambiguousの割合（52.2%）をどう解釈すべきか？
- 分類ルールは明確か？

**仮説**:
- 分類ルールが主観的・曖昧で、ambiguousが多い
- キャラクター特徴と非キャラクター特徴の境界が明確でない

**検証方法**:
- 手動でサンプルデータの分類を検証
- 分類ルールのドキュメントを確認
- 他のラベル付け手法と比較

### 3. タグの使用頻度・相関

**問い**: タグの使用頻度・相関はどうなっているか？

- 人気タグと不人気タグの差は？
- タグ同士の相関は？（例: "blue eyes" と "long hair" の相関）
- time-basedな変化は？（近年のトレンド）

**仮説**:
- キャラクター固有のタグは相関が高い
- タグの使用頻度は時間経過とともに変化している

**検証方法**:
- タグの出現頻度分布を確認
- タグ同士の共起行列を作成
- 時間軸ごとのタグ使用頻度を分析

### 4. データ品質の評価基準

**問い**: データ品質をどう評価するか？

- 品質指標（completeness, consistency, accuracy等）は？
- 現在のデータ品質スコアは？

**仮説**:
- 品質指標を明確化することで、データ改善の指針が得られる
- 現在のデータ品質スコアは70-80%程度

**検証方法**:
- 品質指標の定義（completeness, consistency, accuracy, timeliness等）
- 各指標のスコアリング
- 全体品質スコアの算出

### 5. タグ階層の深さ分布

**問い**: タグ階層の深さはどのような分布か？

- 平均階層深さは？
- 最大/最小の深さは？
- 深さごとのタグ数分布は？

**仮説**:
- 平均階層深さは3-5程度
- 深さが浅いタグ（depth<=2）は主要なカテゴリ
- 深さが深いタグ（depth>=7）は詳細な特徴

**検証方法**:
- depthフィールドの分布確認
- 深さごとのタグ数を可視化

### 6. タググループの一貫性

**問い**: タググループの定義は一貫しているか？

- 同じ階層レベルのタググループは同様の粒度か？
- tag_and_tag_groupとtag_group_onlyの違いは明確か？

**仮説**:
- タググループの定義が統一されていない（粒度が混在）
- 一部のタググループが曖昧（どちらにも分類可能）

**検証方法**:
- 同じdepthのタググループの下位タグ数を比較
- 分類ルールの適用結果を確認

## 仮説検証の優先順位

1. **タグ階層の完全性** - 基礎品質のため最優先
2. **特徴分類の精度** - プロジェクトの目的に関連
3. **タグの使用頻度・相関** - 機械学習利用に役立つ
4. **データ品質の評価基準** - データ改善の指針
5. **タグ階層の深さ分布** - データ構造の理解
6. **タググループの一貫性** - 定義の改善

## 分析手法

### 使用スクリプト

| 問い | 使用スクリプト |
|------|--------------|
| タグ階層の完全性 | 新規作成予定 |
| 特徴分類の精度 | 新規作成予定 |
| タグの使用頻度・相関 | quick_tag_analysis.py, llamaindex_tag_analyzer.py |
| データ品質の評価基準 | 新規作成予定 |
| タグ階層の深さ分布 | analyze_normalized_data_structure.py |
| タググループの一貫性 | analyze_normalized_data_structure.py |

### 計測指標

- 完全性: 階層欠損率、循環参照数
- 精度: 手動ラベル付けとの一致率
- 頻度: 出現回数、出現確率
- 相関: 共起行列、相関係数
- 品質スコア: 各指標の加重平均
